\documentclass[a4paper,12pt]{article}

\usepackage{ctex}      % 中文支持
\usepackage{amsmath}    % 数学公式
\usepackage{graphicx}   % 图片支持
\usepackage{enumitem}   % 自定义列表
\usepackage{listings}   % *** 新增: 代码展示支持 ***
\usepackage{xcolor}     % 用于颜色定义，配合 listings

% 自动编号 Q1 / Q2 / Q3 ...
\newcounter{qcounter}
\newcommand{\question}[1]{%
	\stepcounter{qcounter}%
	\noindent\textbf{Q\theqcounter: #1}\par
}

\newcommand{\answer}[1]{%
	\noindent\textbf{A:} #1\par\vspace{1em}
}

% 定义环境（可选）
\newcommand{\definition}[1]{%
	\noindent\textbf{【定义】} #1\par\vspace{0.5em}
}

% *** 新增: listings 代码样式设置 ***
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codebackground}{rgb}{0.95,0.95,0.95}
\lstset{
	backgroundcolor=\color{codebackground},  % 设置背景色
	basicstyle=\ttfamily\small,            % 设置字体样式和大小
	breaklines=true,                       % 自动换行
	frame=single,                          % *** 设置边框：'single' 是一个单框 ***
	framesep=5pt,                          % 边框与代码的距离
	frameround=tttt,                       % 边框角为圆角 (可选)
	rulecolor=\color{black},               % 边框颜色
	numbers=left,                          % 行号在左侧
	numberstyle=\tiny\color{codegray},     % 行号样式
	captionpos=b,                          % 标题位置 (底部)
	keywordstyle=\color{blue}\bfseries,    % 关键词颜色和加粗
	identifierstyle=\color{black},         % 标识符颜色
	commentstyle=\color{codegray},         % 注释颜色
	stringstyle=\color{orange},            % 字符串颜色
	showtabs=false,                        % 不显示制表符
	tabsize=4                              % 制表符大小
}
% *** 结束代码样式设置 ***


\begin{document}
	
	\section*{TCP 三次握手与代码示例}
	
	\question{为什么 TCP 需要三次握手？}
	\answer{因为两次握手无法确认双方都能可靠收发对方的报文。}
	
	% *** 新增代码模块示例 ***
	\subsection*{Python 模拟连接建立}
	\begin{lstlisting}[language=Python, caption=一个简化的TCP客户端连接模拟]
		import socket
		
		# 模拟三次握手的客户端部分
		def client_connect(host, port):
		try:
		# 1. 客户端发送 SYN (connect()调用)
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		print(f"Client:发送SYN到{host}:{port}")
		s.connect((host, port)) 
		
		# 2. 收到服务器的 SYN-ACK (系统内部处理)
		# 3. 客户端发送 ACK (系统内部处理)
		print("Client: 收到 SYN-ACK 并发送 ACK，连接建立成功！")
		s.close()
		except Exception as e:
		print(f"连接失败: {e}")
		
		if __name__ == "__main__":
		# 注意: 实际运行需要一个监听的服务器
		# client_connect('127.0.0.1', 8080)
		print("代码演示，未实际运行 socket.connect()")
	\end{lstlisting}
	% *** 结束代码模块示例 ***
	
	\question{如果第三次握手的 ACK 丢失，会怎样？}
	\answer{服务器认为连接已建立，客户端会重发 ACK 或继续通信。}
	
	\definition{TCP（传输控制协议）是一种面向连接、可靠的传输层协议。}
	
	
\end{document}